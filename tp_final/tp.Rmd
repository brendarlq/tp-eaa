---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
install.packages("openxlsx")
```

# Trabajo Práctico Final

# 1) Fuente de datos

## Carga el dataset
.
```{r}
library(openxlsx)
delitos <- read.xlsx("/Users/bquinonez//Downloads/delitos_2023.xlsx")
delitos
```
```{r}
summary(delitos)

```
```{r}
dim(delitos)
```

# 1) Preprocesamiento

## Verificación de nulos

```{r}
colSums(is.na(delitos))
```
Tipos de Delitos

```{r}
cantidad_valores_unicos <- (unique(delitos$tipo))
print(cantidad_valores_unicos)
```

Subtipos de delitos

```{r}
conteo_por_tipo <- table(delitos$tipo)
print(conteo_por_tipo)
```

```{r}
cantidad_valores_unicos <- (unique(delitos$subtipo))
print(cantidad_valores_unicos)
conteo_por_subtipo <- table(delitos$subtipo)
print(conteo_por_subtipo)
```


## Creación de variables

Agregamos la columna de franja horaria

```{r}
#Genero la columna franja(horaria)
delitos <- delitos %>%
  mutate(
    franja_horaria = case_when(
      franja >= 6 & franja < 12 ~ "Mañana",
      franja >= 12 & franja < 18 ~ "Tarde",
      franja >= 18 & franja < 24 ~ "Noche",
      franja >= 0 & franja < 6  ~ "Madrugada",
      TRUE ~ "Desconocido" # Para casos fuera de rango 
    )
  )
delitos
```

Agregamos una columna que indica si es fin de semana o día de semana

```{r}
delitos$tipo_dia <- ifelse(delitos$dia %in% c("SAB", "DOM"),
                                             "Fin de semana", "Día de semana")
delitos
```

Agregamos una columna que indica la estación del año

```{r}
# Crear columna 'estacion' basada en el mes
delitos <- delitos %>%
  mutate(
    estacion = case_when(
      mes %in% c("diciembre", "enero", "febrero") ~ "Verano",
      mes %in% c("marzo", "abril", "mayo")       ~ "Otoño",
      mes %in% c("junio", "julio", "agosto")     ~ "Invierno",
      mes %in% c("septiembre", "octubre", "noviembre") ~ "Primavera",
      TRUE ~ "Desconocido" # Para casos no esperados
    )
  )
delitos
```



## Transformación de variables categóricas

Transformamos todos los caracteres a numéricos

```{r}

# Convertir todas las variables categóricas (character o factor) a numéricas
delitos <- delitos %>%
  mutate(across(
    .cols = where(is.character) & !all_of(c("longitud", "latitud")), 
    .fns = ~ as.numeric(as.factor(.))
  )) %>%
  mutate(across(
    .cols = where(is.factor) & !all_of(c("longitud", "latitud")), 
    .fns = ~ as.numeric(.)
  ))

# Verificar la estructura después de la conversión
delitos

```
Converisón de coordenas a númerico

```{r}
# Convertir longitud y latitud a numéricas y escalarlas correctamente
delitos <- delitos %>%
  mutate(
    longitud = as.numeric(longitud) / 1e6,  # Escalar dividiendo entre 10^6
    latitud = as.numeric(latitud) / 1e6    # Escalar dividiendo entre 10^6
  )

# Verificar las primeras filas para confirmar
head(delitos[c("longitud", "latitud")])
```



